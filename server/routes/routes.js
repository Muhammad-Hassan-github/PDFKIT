let dataObj = {
  "headers": {
    "title": "Order to",
    "date": "Order date",
    "invoiceId": "Order nr",
    "noVat": "VAT Statement:",
    "note": "Note:",
    "page": "Page",
    "payment_terms": "Payment Terms:",
    "total": "Total",
    "totals": {
      "noDiscount": "Total Order",
      "discount": "Total Discount (10%)",
      "vatCategories": [
        {
          "category": "9",
          "totalPrice": "Total 9% Vat Category",
          "totalVat": "9% Vat"
        }
      ],
      "totalProducts": "Products",
      "exVat": "Total Ex Vat",
      "incVat": "TOTAL",
      "vat": "Total Vat"
    },
    "products": {
      "code": "Code",
      "contents": "Contents",
      "description": "Description",
      "price": "Price",
      "quantity": "Qty",
      "total": "Total Price",
      "vat": "Vat"
    },
    "profile": {
      "debtorId": "Debtor ID"
    },
    "customer": {
      "coc": "CoC",
      "email": "Email",
      "fax": "Fax",
      "mobile": "Mobile",
      "telephone": "Tel",
      "vat": "Vat",
      "website": "Website"
    }
  },
  "profile": {
    "city": "Hengelo",
    "coc": "76119572",
    "country": "Nederland",
    "email": "emrahhanokruiden40@gmail.com",
    "fax": "",
    "image": "https://newflow.orapay.io/api/v1/images/a6b92c249dc5c913354121257f6992f5_13abbbbc909a6cac42eb654607bab1bdb33d4bd60dcacf0600383f38d33da99565c1ca4b9773c7e469f2b13b27dc5732d09bc425a49ad7569018278cf156ce6cb4ca0249bb17874a10908330d03f895c6673a3baf06031731f9b56e73e749161bc43532a2d9c24d698c13021219ada7c",
    "mobile": "+31642114250",
    "name": "Or.a Trade Solutions BV",
    "street": "Agonstraat",
    "streetNumber": "8",
    "telephone": "+31642114250",
    "vat": "NL860514298B01",
    "website": "www.ora-ts.com",
    "zip": "7552 TJ"
  },
  "customer": {
    "coc": "1",
    "country": "Zimbabue",
    "city": "Harare",
    "debtorId": "123",
    "name": "Acme",
    "streetNumber": "123",
    "street": "Robert mugabe ave",
    "vatApplicable": 1,
    "zip": "0123"
  },
  "products": [
    {
      "description": "Amsterdammertje . (200 gr)",
      "code": "AH-357528",
      "invoicePrice": "$2.66",
      "vat": "9%",
      "contents": "1",
      "quantity": 1,
      "total": "$2.66"
    },
    {
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },{
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },
    {
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    }, {
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    }, {
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    }, {
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },
    {
      "description": "Tripel Karmeliet . (330 ml)",
      "code": "AH-438908",
      "invoicePrice": "$6.89",
      "vat": "9%",
      "contents": "4",
      "quantity": 1,
      "total": "$6.89"
    }, {
      "description": "Tripel Karmeliet . (330 ml)",
      "code": "AH-438908",
      "invoicePrice": "$6.89",
      "vat": "9%",
      "contents": "4",
      "quantity": 1,
      "total": "$6.89"
    }, {
      "description": "Tripel Karmeliet . (330 ml)",
      "code": "AH-438908",
      "invoicePrice": "$6.89",
      "vat": "9%",
      "contents": "4",
      "quantity": 1,
      "total": "$6.89"
    }, {
      "description": "Tripel Karmeliet . (330 ml)",
      "code": "AH-438908",
      "invoicePrice": "$6.89",
      "vat": "9%",
      "contents": "4",
      "quantity": 1,
      "total": "$6.89"
    }, {
      "description": "Tripel Karmeliet . (330 ml)",
      "code": "AH-438908",
      "invoicePrice": "$6.89",
      "vat": "9%",
      "contents": "4",
      "quantity": 1,
      "total": "$6.89"
    }, {
      "description": "Tripel Karmeliet . (330 ml)",
      "code": "AH-438908",
      "invoicePrice": "$6.89",
      "vat": "9%",
      "contents": "4",
      "quantity": 1,
      "total": "$6.89"
    }, {
      "description": "Tripel Karmeliet . (330 ml)",
      "code": "AH-438908",
      "invoicePrice": "$6.89",
      "vat": "9%",
      "contents": "4",
      "quantity": 1,
      "total": "$6.89"
    }, {
      "description": "Tripel Karmeliet . (330 ml)",
      "code": "AH-438908",
      "invoicePrice": "$6.89",
      "vat": "9%",
      "contents": "4",
      "quantity": 1,
      "total": "$6.89"
    }, {
      "description": "Tripel Karmeliet . (330 ml)",
      "code": "AH-438908",
      "invoicePrice": "$6.89",
      "vat": "9%",
      "contents": "4",
      "quantity": 1,
      "total": "$6.89"
    }, {
      "description": "Tripel Karmeliet . (330 ml)",
      "code": "AH-438908",
      "invoicePrice": "$6.89",
      "vat": "9%",
      "contents": "4",
      "quantity": 1,
      "total": "$6.89"
    },
    {
      "description": "Some product with VAT 21",
      "code": "AH-435908",
      "invoicePrice": "$150",
      "vat": "21%",
      "contents": "4",
      "quantity": 1,
      "total": "$150"
    },
    {
      "description": "Some other product with VAT 21",
      "code": "AH-538908",
      "invoicePrice": "$50",
      "vat": "21%",
      "contents": "4",
      "quantity": 1,
      "total": "$50"
    }
  ],
  "date": "2020-03-18",
  "totals": {
    "vatCategories": [
      {
        "category": "9",
        "totalPrice": "$191.34",
        "totalVat": "$17.22"
      },
      {
        "category": "21",
        "totalPrice": "$200",
        "totalVat": "$42"
      }
    ],
    "discount": "$41.26",
    "exVat": "$371.34",
    "incVat": "$430.56",
    "noDiscount": "$412.60",
    "totalProducts": 43,
    "vat": "$59.22",
    "total": "$430.56"
  },
  "settings": {
    "paymentTerms": "Within 14 days after invoice date.",
    "note": "Some note to customers",
    "footer": "This should show on each page at the footer.",
    "primaryColor": "#bbdefb",
    "secondaryColor": "#e3f2fd"
  },
  "invoiceId": "ORD-123-000037"
}

var dotenv = require('dotenv');
var path = require("path")
const PDFDocument = require('pdfkit');
const fs = require('fs');
const invoice = {
  shipping: {
    name: "John Doe",
    address: "1234 Main Street",
    city: "San Francisco",
    state: "CA",
    country: "US",
    postal_code: 94111
  },
  items: [
    {
      item: "TC 100",
      description: "Toner Cartridge",
      quantity: 2,
      amount: 6000
    },
    {
      item: "USB_EXT",
      description: "USB Cable Extender",
      quantity: 1,
      amount: 2000
    }
  ],
  subtotal: 8000,
  paid: 0,
  invoice_nr: 1234
};

dotenv.config();

module.exports = function (server) {
  server.get('/generatePdf', (req, res) => {
    let doc = new PDFDocument({ margin: 50 });
    function generateHeader(doc) {
      doc
        .image(__dirname + '/img.jpg', 40, 30, { fit: [180, 230] })
        .roundedRect(365, 30, 220, 210, 10)
        .fillAndStroke(`${dataObj.settings.primaryColor}`, `${dataObj.settings.primaryColor}`)
        .fill('black').stroke()
        .fontSize(15).font('Helvetica-Bold').text(`${dataObj.headers.title}:`, 40, 110)
        .fontSize(12).font('Times-Bold').text(`${dataObj.customer.name}`, 40, 140)
        .fontSize(9)
        .font('Times-Roman').text(`${dataObj.customer.street}  ${dataObj.customer.streetNumber}`, 40, 170)
        .text(`${dataObj.customer.zip}, ${dataObj.customer.city}`, 40, 180)
        .text(`${dataObj.customer.country}`, 40, 190)

        .text(`Debtor: ${dataObj.customer.debtorId}`, 40, 220)
        .text(`Vat: ${dataObj.profile.vat}`, 40, 230)

        .text("Tel:", 380, 110)
        .text("Mobile:", 380, 130)
        .text("Email:", 380, 150)
        .text("Website:", 380, 170)
        .text("CoC:", 380, 190)
        .text("Vat:", 380, 210)

        .fontSize(10).font('Helvetica-Bold').text(`${dataObj.profile.name}`, 0, 50, { align: "right" })
        .fontSize(9).font('Times-Roman').text(`${dataObj.profile.street}  ${dataObj.profile.streetNumber}`, 0, 70, { align: "right" })
        .text(`${dataObj.profile.zip}, ${dataObj.profile.city}`, 0, 80, { align: "right" })
        .text(`${dataObj.profile.country}`, 0, 90, { align: "right" })

        .text(`${dataObj.profile.telephone}`, 0, 110, { align: "right" })
        .text(`${dataObj.profile.mobile}`, 0, 130, { align: "right" })
        .text(`${dataObj.profile.email}`, 0, 150, { align: "right" })
        .text(`${dataObj.profile.website}`, 0, 170, { align: "right" })
        .text(`${dataObj.profile.coc}`, 0, 190, { align: "right" })
        .text(`${dataObj.profile.vat}`, 0, 210, { align: "right" })

        .fontSize(10)
        .roundedRect(50, 270, 530, 30, 8)
        .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
        .fill('black').stroke()

        .text("Order nr", 140, 275)
        .text("Order date", 240, 275)
        .text("Products", 350, 275)
        .text("Page", 480, 275)

        .font('Times-Bold').text(`${dataObj.invoiceId}`, 120, 285)
        .text(`${dataObj.date}`, 240, 285)
        .text(`${dataObj.totals.totalProducts}`, 360, 285)
        .text(`${dataObj.headers.page}`, 480, 285)

        .font('Times-Roman').roundedRect(50, 340, 520, 0, 0)
        .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
        .fill('black').stroke()

        .font('Times-Bold').text("#", 50, 325)
        .text("Code", 70, 325)
        .text("Description", 130, 325)
        .text("Contents", 355, 325)
        .text("Vat", 405, 325)
        .text("Qty", 435, 325)
        .text("Price", 480, 325)
        .text("Total", 0, 325, { align: "right" })

      doc.font('Times-Roman').roundedRect(50, doc.page.height - 35, 520, 0, 0)
        .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
        .fill('black').stroke()
      doc.text('footer footer  footer  footer  footer  footer', 250, doc.page.height - 30, {
        align: "center",
        lineBreak: false,
      });
    }

    function generateTableRow(doc, y, c1, c2, c3, c4, c5, c6, c7, c8) {
      doc
        .fontSize(9)
        .font('Times-Roman')
        .font('Times-Bold').text(c1, 50, y)
        .font('Times-Roman').text(c2, 70, y)
        .text(c3, 130, y)
        .text(c4, 380, y)
        .text(c5, 410, y)
        .text(c6, 440, y)
        .text(c7, 480, y)
        .text(c8, 0, y, { align: "right" });

    }

    function generateInvoiceTable(doc, invoice) {
      let i,
        invoiceTableTop = 340;
      for (i = 0; i < dataObj.products.length; i++) {
        const item = dataObj.products[i];
        function lastResult() {
          doc
            .roundedRect(350, 30 + invoiceTableTop + dataObj.products.length * 10, 215, 20, 0)
            .fillAndStroke(`${dataObj.settings.primaryColor}`)
            .fill('black').stroke()
            .text(`Total Order    ${dataObj.totals.noDiscount}`, 50, 35 + invoiceTableTop + dataObj.products.length * 10, { align: "right" })

            .roundedRect(350, 50 + invoiceTableTop + dataObj.products.length * 10, 215, 20, 0)
            .fillAndStroke(`${dataObj.settings.secondaryColor}`)
            .fill('black').stroke()
            .text(`Total Discount (10%)  ${dataObj.totals.discount}`, 50, 55 + invoiceTableTop + dataObj.products.length * 10, { align: "right" })

          let numberFirst = dataObj.totals.vatCategories.length;
          // let numberFirst = 1
          for (let a = 1; a <= numberFirst; a++) {

            doc
              .roundedRect(350, (a * 20) + 50 + invoiceTableTop + dataObj.products.length * 10, 215, 20, 0)
              .fillAndStroke(`${dataObj.settings.primaryColor}`)
              .fill('black').stroke()
              .text(`Total ${dataObj.totals.vatCategories[a - 1].category}% Vat Category  ${dataObj.totals.vatCategories[a - 1].totalPrice}  `, 50, (a * 20) + 55 + invoiceTableTop + dataObj.products.length * 10, { align: "right" })

          }
          doc.roundedRect(350, (numberFirst * 20) + 70 + invoiceTableTop + dataObj.products.length * 10, 215, 20, 0)
            .fillAndStroke(`${dataObj.settings.secondaryColor}`)
            .fill('black').stroke()
            .text(`Total Ex Vat  ${dataObj.totals.exVat}`, 50, (numberFirst * 20) + 75 + invoiceTableTop + dataObj.products.length * 10, { align: "right" })

          let number = dataObj.totals.vatCategories.length;

          for (let i = 1; i <= number; i++) {

            doc.roundedRect(350, ((numberFirst - 1 + i) * 20) + 90 + invoiceTableTop + dataObj.products.length * 10, 215, 20, 0)
              .fillAndStroke(`${dataObj.settings.primaryColor}`)
              .fill('black').stroke()
              .text(`${dataObj.totals.vatCategories[i - 1].category}% Vat   ${dataObj.totals.vatCategories[i - 1].totalVat}  `, 50, ((numberFirst - 1 + i) * 20) + 95 + invoiceTableTop + dataObj.products.length * 10, { align: "right" })
          }
          doc.roundedRect(350, ((number + numberFirst - 1) * 20) + 110 + invoiceTableTop + dataObj.products.length * 10, 215, 20, 0)
            .fillAndStroke(`${dataObj.settings.secondaryColor}`)
            .fill('black').stroke()
            .text(`Total Vat   ${dataObj.totals.vat}`, 50, ((number + numberFirst - 1) * 20) + 115 + invoiceTableTop + dataObj.products.length * 10, { align: "right" })

            .roundedRect(350, ((number + numberFirst - 1) * 20) + 150 + invoiceTableTop + dataObj.products.length * 10, 215, 20, 0)
            .fillAndStroke(`${dataObj.settings.primaryColor}`)
            .fill('black').stroke()
            .text(`TOTAL  ${dataObj.totals.total}`, 50, ((number + numberFirst - 1) * 20) + 155 + invoiceTableTop + dataObj.products.length * 10, { align: "right" })

            .text(`Payment Terms : ${dataObj.settings.paymentTerms}`, 50, (number * 20) + 180 + invoiceTableTop + dataObj.products.length * 10)

        }

        if (i < 38) {
          console.log("1", i)
          const position = invoiceTableTop + (i + 1) * 10;
          generateTableRow(
            doc,
            position,
            i + 1,
            item.code,
            item.description,
            item.contents,
            item.vat,
            item.quantity,
            item.invoicePrice,
            item.total,

          );

        }
        if (dataObj.products.length > 15 && dataObj.products.length < 39) {
          console.log("legnth", dataObj.products.length)

          if (dataObj.products.length == i + 1) {
            doc.addPage({
              margin: 50
            })
            console.log("First")
            doc
              .roundedRect(50, 25, 530, 30, 8)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()
              .text("Order nr", 120, 30)
              .text("Order date", 240, 30)
              .text("Products", 360, 30)
              .text("Page", 480, 30)

              .font('Times-Bold').text(`${dataObj.invoiceId}`, 120, 40)
              .text(`${dataObj.date}`, 240, 40)
              .text(`${dataObj.headers.totals.totalProducts}`, 360, 40)
              .text(`${dataObj.headers.page}`, 480, 40)

            doc.font('Times-Roman').roundedRect(50, doc.page.height - 35, 520, 0, 0)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()
            doc.text('footer footer  footer  footer  footer  footer', 250, doc.page.height - 30, {
              align: "center",
              lineBreak: false,
            });

            doc
              .roundedRect(350, 60 + (26 - 25) * 10, 215, 20, 0)
              .fillAndStroke(`${dataObj.settings.primaryColor}`)
              .fill('black').stroke()
              .text(`Total Order    ${dataObj.totals.noDiscount}`, 50, 65 + (26 - 25) * 10, { align: "right" })

              .roundedRect(350, 80 + (26 - 25) * 10, 215, 20, 0)
              .fillAndStroke(`${dataObj.settings.secondaryColor}`)
              .fill('black').stroke()
              .text(`Total Discount (10%)  ${dataObj.totals.discount}`, 50, 85 + (26 - 25) * 10, { align: "right" })
            let numberFirst = dataObj.totals.vatCategories.length;
            // let numberFirst = 1
            for (let a = 1; a <= numberFirst; a++) {

              doc.roundedRect(350, (a * 20) + 80 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total ${dataObj.totals.vatCategories[a - 1].category}% Vat Category  ${dataObj.totals.vatCategories[a - 1].totalPrice}  `, 50, (a * 20) + 85 + (26 - 25) * 10, { align: "right" })

            }
            doc
              .roundedRect(350, (numberFirst * 20) + 100 + (26 - 25) * 10, 215, 20, 0)
              .fillAndStroke(`${dataObj.settings.secondaryColor}`)
              .fill('black').stroke()
              .text(`Total Ex Vat  ${dataObj.totals.exVat}`, 50, (numberFirst * 20) + 105 + (26 - 25) * 10, { align: "right" })
            let number = dataObj.totals.vatCategories.length;
            // let number = 3;

            for (let i = 1; i <= number; i++) {
              doc.roundedRect(350, ((numberFirst - 1 + i) * 20) + 120 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`${dataObj.totals.vatCategories[i - 1].category}% Vat   ${dataObj.totals.vatCategories[i - 1].totalVat}  `, 50, ((numberFirst - 1 + i) * 20) + 125 + (26 - 25) * 10, { align: "right" })
            }

            doc
              .roundedRect(350, (20 * (number + numberFirst - 1)) + 140 + (26 - 25) * 10, 215, 20, 0)
              .fillAndStroke(`${dataObj.settings.secondaryColor}`)
              .fill('black').stroke()
              .text(`Total Vat   ${dataObj.totals.vat}`, 50, (20 * (number + numberFirst - 1)) + 145 + (26 - 25) * 10, { align: "right" })

              .roundedRect(350, (20 * (number + numberFirst - 1)) + 180 + (26 - 25) * 10, 215, 20, 0)
              .fillAndStroke(`${dataObj.settings.primaryColor}`)
              .fill('black').stroke()
              .text(`TOTAL  ${dataObj.totals.total}`, 50, (20 * (number + numberFirst - 1)) + 185 + (26 - 25) * 10, { align: "right" })

              .text(`Payment Terms : ${dataObj.settings.paymentTerms}`, 50, (number * 20) + 230 + (26 - 25) * 10)

          }

        } else if (dataObj.products.length <= 22) {

          if (dataObj.products.length == i + 1) {
            lastResult()
          }
        }
        if (i >= 38 && i < 105) {
          if (i == 38) {
            doc.addPage({
              margin: 50
            })

            // ---------current page -------------

            doc
              .roundedRect(50, 15, 530, 30, 8)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()

              .text("Order nr", 120, 22)
              .text("Order date", 240, 22)
              .text("Products", 360, 22)
              .text("Page", 480, 22)


              .font('Times-Bold').text(`${dataObj.invoiceId}`, 120, 32)
              .text(`${dataObj.date}`, 240, 32)
              .text(`${dataObj.headers.totals.totalProducts}`, 360, 32)
              .text(`${dataObj.headers.page}`, 480, 32)

            // ---------current page -------------

            doc.font('Times-Roman').roundedRect(50, doc.page.height - 35, 520, 0, 0)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()
            doc.text('footer footer  footer  footer  footer  footer', 250, doc.page.height - 30, {
              align: "center",
              lineBreak: false,
            });

            doc.font('Times-Bold').text("#", 50, 50)
              .text("Code", 70, 50)
              .text("Description", 130, 50)
              .text("Contents", 355, 50)
              .text("Qty", 405, 50)
              .text("Vat", 435, 50)
              .text("Price", 480, 50)
              .text("Total", 0, 50, { align: "right" })

              .font('Times-Roman').roundedRect(50, 65, 520, 0, 0)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()

          }

          const position = 50 + ((i - 37) + 1) * 10;
          generateTableRow(
            doc,
            position,
            i + 1,
            item.code,
            item.description,
            item.contents,
            item.vat,
            item.quantity,
            item.invoicePrice,
            item.total,

          );

          if (i < 86) {
            if (dataObj.products.length == i + 1) {
              doc
                .roundedRect(350, 30 + (dataObj.products.length - 30) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total Order    ${dataObj.totals.noDiscount}`, 50, 35 + (dataObj.products.length - 30) * 10, { align: "right" })

                .roundedRect(350, 50 + (dataObj.products.length - 30) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Discount (10%)  ${dataObj.totals.discount}`, 50, 55 + (dataObj.products.length - 30) * 10, { align: "right" })


              let numberFirst = dataObj.totals.vatCategories.length;
              // let numberFirst = 1
              for (let a = 1; a <= numberFirst; a++) {

                doc
                  .roundedRect(350, (a*20)+50 + (dataObj.products.length - 30) * 10, 215, 20, 0)
                  .fillAndStroke(`${dataObj.settings.primaryColor}`)
                  .fill('black').stroke()
                  .text(`Total ${dataObj.totals.vatCategories[a - 1].category}% Vat Category  ${dataObj.totals.vatCategories[a - 1].totalPrice}  `, 50, (a*20)+55 + (dataObj.products.length - 30) * 10, { align: "right" })
              }
              doc
                .roundedRect(350, (numberFirst*20)+70 + (dataObj.products.length - 30) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Ex Vat  ${dataObj.totals.exVat}`, 50, (numberFirst*20)+75 + (dataObj.products.length - 30) * 10, { align: "right" })


              let number = dataObj.totals.vatCategories.length;

              for (let i = 1; i <= number; i++) {

                doc.roundedRect(350, ((numberFirst - 1 + i) * 20) + 90 + (dataObj.products.length - 30) * 10, 215, 20, 0)
                  .fillAndStroke(`${dataObj.settings.primaryColor}`)
                  .fill('black').stroke()
                  .text(`${dataObj.totals.vatCategories[i - 1].category}% Vat   ${dataObj.totals.vatCategories[i - 1].totalVat}`, 50, ((numberFirst - 1 + i) * 20)+ 95 + (dataObj.products.length - 30) * 10, { align: "right" })
              }
              doc.roundedRect(350, ((number + numberFirst - 1) * 20) + 110 + (dataObj.products.length - 30) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Vat   ${dataObj.totals.vat}`, 50, ((number + numberFirst - 1) * 20) + 115 + (dataObj.products.length - 30) * 10, { align: "right" })

                .roundedRect(350, ((number + numberFirst - 1) * 20) + 150 + (dataObj.products.length - 30) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`TOTAL   ${dataObj.totals.total}`, 50, ((number + numberFirst - 1) * 20) + 155 + (dataObj.products.length - 30) * 10, { align: "right" })

                .text(`Payment Terms : ${dataObj.settings.paymentTerms}`, 50, (number * 20) + 180 + (dataObj.products.length - 30) * 10)

            }
          }
          else {

            if (dataObj.products.length == i + 1) {
              doc.addPage({
                margin: 50
              })
              doc
                .roundedRect(50, 25, 530, 30, 8)
                .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text("Order nr", 120, 30)
                .text("Order date", 240, 30)
                .text("Products", 360, 30)
                .text("Page", 480, 30)

                .font('Times-Bold').text(`${dataObj.invoiceId}`, 120, 40)
                .text(`${dataObj.date}`, 240, 40)
                .text(`${dataObj.headers.totals.totalProducts}`, 360, 40)
                .text(`${dataObj.headers.page}`, 480, 40)
              doc.font('Times-Roman').roundedRect(50, doc.page.height - 35, 520, 0, 0)
                .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
              doc.text('footer footer  footer  footer  footer  footer', 250, doc.page.height - 30, {
                align: "center",
                lineBreak: false,
              });

              doc
                .roundedRect(350, 60 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total Order    ${dataObj.totals.noDiscount}`, 50, 65 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 80 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Discount (10%)  ${dataObj.totals.discount}`, 50, 85 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 100 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total 9% Vat Category   ${dataObj.totals.vatCategories[0].totalPrice}`, 50, 105 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 120 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Ex Vat  ${dataObj.totals.exVat}`, 50, 125 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 140 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`9% Vat   ${dataObj.totals.vatCategories[0].totalVat}`, 50, 145 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 160 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Vat   ${dataObj.totals.vat}`, 50, 165 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 200 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`TOTAL  ${dataObj.totals.total}`, 50, 205 + (26 - 25) * 10, { align: "right" })

                .text(`Payment Terms : ${dataObj.settings.paymentTerms}`, 50, 230 + (26 - 25) * 10)

            }
          }
        }
        if (i >= 105 && i < 172) {

          if (i == 105) {
            doc.addPage({
              margin: 50
            })

            // ---------current page -------------

            doc
              .roundedRect(50, 15, 530, 30, 8)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()

              .text("Order nr", 120, 22)
              .text("Order date", 240, 22)
              .text("Products", 360, 22)
              .text("Page", 480, 22)


              .font('Times-Bold').text(`${dataObj.invoiceId}`, 120, 32)
              .text(`${dataObj.date}`, 240, 32)
              .text(`${dataObj.headers.totals.totalProducts}`, 360, 32)
              .text(`${dataObj.headers.page}`, 480, 32)

            // ---------current page -------------
            doc.font('Times-Roman').roundedRect(50, doc.page.height - 35, 520, 0, 0)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()
            doc.text('footer footer  footer  footer  footer  footer', 250, doc.page.height - 30, {
              align: "center",
              lineBreak: false,
            });

            doc.font('Times-Bold').text("#", 50, 50)
              .text("Code", 70, 50)
              .text("Description", 130, 50)
              .text("Contents", 355, 50)
              .text("Qty", 405, 50)
              .text("Vat", 435, 50)
              .text("Price", 480, 50)
              .text("Total", 0, 50, { align: "right" })

              .font('Times-Roman').roundedRect(50, 65, 520, 0, 0)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()

          }

          const position = 50 + ((i - 104) + 1) * 10;
          generateTableRow(
            doc,
            position,
            i + 1,
            item.code,
            item.description,
            item.contents,
            item.vat,
            item.quantity,
            item.invoicePrice,
            item.total,

          );

          if (i < 155) {
            if (dataObj.products.length == i + 1) {
              doc
                .roundedRect(350, 30 + (dataObj.products.length - 100) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total Order    ${dataObj.totals.noDiscount}`, 50, 35 + (dataObj.products.length - 100) * 10, { align: "right" })

                .roundedRect(350, 50 + (dataObj.products.length - 100) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Discount (10%)  ${dataObj.totals.discount}`, 50, 55 + (dataObj.products.length - 100) * 10, { align: "right" })

                .roundedRect(350, 70 + (dataObj.products.length - 100) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total 9% Vat Category   ${dataObj.totals.vatCategories[0].totalPrice}`, 50, 75 + (dataObj.products.length - 100) * 10, { align: "right" })

                .roundedRect(350, 90 + (dataObj.products.length - 100) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Ex Vat  ${dataObj.totals.exVat}`, 50, 95 + (dataObj.products.length - 100) * 10, { align: "right" })

                .roundedRect(350, 110 + (dataObj.products.length - 100) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`9% Vat   ${dataObj.totals.vatCategories[0].totalVat}`, 50, 115 + (dataObj.products.length - 100) * 10, { align: "right" })

                .roundedRect(350, 130 + (dataObj.products.length - 100) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Vat   ${dataObj.totals.vat}`, 50, 135 + (dataObj.products.length - 100) * 10, { align: "right" })

                .roundedRect(350, 160 + (dataObj.products.length - 100) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`TOTAL  ${dataObj.totals.total}`, 50, 165 + (dataObj.products.length - 100) * 10, { align: "right" })

                .text(`Payment Terms : ${dataObj.settings.paymentTerms}`, 50, 180 + (dataObj.products.length - 100) * 10)
            }
          }
          else {

            if (dataObj.products.length == i + 1) {
              doc.addPage({
                margin: 50
              })
              doc
                .roundedRect(50, 25, 530, 30, 8)
                .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text("Order nr", 120, 30)
                .text("Order date", 240, 30)
                .text("Products", 360, 30)
                .text("Page", 480, 30)

                .font('Times-Bold').text(`${dataObj.invoiceId}`, 120, 40)
                .text(`${dataObj.date}`, 240, 40)
                .text(`${dataObj.headers.totals.totalProducts}`, 360, 40)
                .text(`${dataObj.headers.page}`, 480, 40)
              doc.font('Times-Roman').roundedRect(50, doc.page.height - 35, 520, 0, 0)
                .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
              doc.text('footer footer  footer  footer  footer  footer', 250, doc.page.height - 30, {
                align: "center",
                lineBreak: false,
              });

              doc
                .roundedRect(350, 60 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total Order    ${dataObj.totals.noDiscount}`, 50, 65 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 80 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Discount (10%)  ${dataObj.totals.discount}`, 50, 85 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 100 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total 9% Vat Category   ${dataObj.totals.vatCategories[0].totalPrice}`, 50, 105 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 120 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Ex Vat  ${dataObj.totals.exVat}`, 50, 125 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 140 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`9% Vat   ${dataObj.totals.vatCategories[0].totalVat}`, 50, 145 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 160 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Vat   ${dataObj.totals.vat}`, 50, 165 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 200 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`TOTAL  ${dataObj.totals.total}`, 50, 205 + (26 - 25) * 10, { align: "right" })

                .text(`Payment Terms : ${dataObj.settings.paymentTerms}`, 50, 180 + (dataObj.products.length - 165) * 10)

            }

          }

        }
        if (i >= 172 && i < 239) {

          if (i == 172) {
            doc.addPage({
              margin: 50
            })

            // ---------current page -------------

            doc
              .roundedRect(50, 15, 530, 30, 8)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()

              .text("Order nr", 120, 22)
              .text("Order date", 240, 22)
              .text("Products", 360, 22)
              .text("Page", 480, 22)


              .font('Times-Bold').text(`${dataObj.invoiceId}`, 120, 32)
              .text(`${dataObj.date}`, 240, 32)
              .text(`${dataObj.headers.totals.totalProducts}`, 360, 32)
              .text(`${dataObj.headers.page}`, 480, 32)

            // ---------current page -------------

            doc.font('Times-Roman').roundedRect(50, doc.page.height - 35, 520, 0, 0)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()
            doc.text('footer footer  footer  footer  footer  footer', 250, doc.page.height - 30, {
              align: "center",
              lineBreak: false,
            });

            doc.font('Times-Bold').text("#", 50, 50)
              .text("Code", 70, 50)
              .text("Description", 130, 50)
              .text("Contents", 355, 50)
              .text("Qty", 405, 50)
              .text("Vat", 435, 50)
              .text("Price", 480, 50)
              .text("Total", 0, 50, { align: "right" })

              .font('Times-Roman').roundedRect(50, 65, 520, 0, 0)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()
          }

          const position = 50 + ((i - 171) + 1) * 10;
          generateTableRow(
            doc,
            position,
            i + 1,
            item.code,
            item.description,
            item.contents,
            item.vat,
            item.quantity,
            item.invoicePrice,
            item.total,

          );

          if (i < 220) {
            if (dataObj.products.length == i + 1) {
              doc
                .roundedRect(350, 30 + (dataObj.products.length - 165) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total Order    ${dataObj.totals.noDiscount}`, 50, 35 + (dataObj.products.length - 165) * 10, { align: "right" })

                .roundedRect(350, 50 + (dataObj.products.length - 165) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Discount (10%)  ${dataObj.totals.discount}`, 50, 55 + (dataObj.products.length - 165) * 10, { align: "right" })

                .roundedRect(350, 70 + (dataObj.products.length - 165) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total 9% Vat Category   ${dataObj.totals.vatCategories[0].totalPrice}`, 50, 75 + (dataObj.products.length - 165) * 10, { align: "right" })

                .roundedRect(350, 90 + (dataObj.products.length - 165) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Ex Vat  ${dataObj.totals.exVat}`, 50, 95 + (dataObj.products.length - 165) * 10, { align: "right" })

                .roundedRect(350, 110 + (dataObj.products.length - 165) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`9% Vat   ${dataObj.totals.vatCategories[0].totalVat}`, 50, 115 + (dataObj.products.length - 165) * 10, { align: "right" })

                .roundedRect(350, 130 + (dataObj.products.length - 165) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Vat   ${dataObj.totals.vat}`, 50, 135 + (dataObj.products.length - 165) * 10, { align: "right" })

                .roundedRect(350, 160 + (dataObj.products.length - 165) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`TOTAL  ${dataObj.totals.total}`, 50, 165 + (dataObj.products.length - 165) * 10, { align: "right" })

                .text(`Payment Terms : ${dataObj.settings.paymentTerms}`, 50, 180 + (dataObj.products.length - 165) * 10)

            }
          }
          else {

            if (dataObj.products.length == i + 1) {
              doc.addPage({
                margin: 50
              })
              doc
                .roundedRect(50, 25, 530, 30, 8)
                .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text("Order nr", 120, 30)
                .text("Order date", 240, 30)
                .text("Products", 360, 30)
                .text("Page", 480, 30)

                .font('Times-Bold').text(`${dataObj.invoiceId}`, 120, 40)
                .text(`${dataObj.date}`, 240, 40)
                .text(`${dataObj.headers.totals.totalProducts}`, 360, 40)
                .text(`${dataObj.headers.page}`, 480, 40)
              doc.font('Times-Roman').roundedRect(50, doc.page.height - 35, 520, 0, 0)
                .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
              doc.text('footer footer  footer  footer  footer  footer', 250, doc.page.height - 30, {
                align: "center",
                lineBreak: false,
              });

              doc
                .roundedRect(350, 60 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total Order    ${dataObj.totals.noDiscount}`, 50, 65 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 80 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Discount (10%)  ${dataObj.totals.discount}`, 50, 85 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 100 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total 9% Vat Category   ${dataObj.totals.vatCategories[0].totalPrice}`, 50, 105 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 120 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Ex Vat  ${dataObj.totals.exVat}`, 50, 125 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 140 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`9% Vat   ${dataObj.totals.vatCategories[0].totalVat}`, 50, 145 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 160 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Vat   ${dataObj.totals.vat}`, 50, 165 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 200 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`TOTAL  ${dataObj.totals.total}`, 50, 205 + (26 - 25) * 10, { align: "right" })

                .text(`Payment Terms : ${dataObj.settings.paymentTerms}`, 50, 230 + (26 - 25) * 10)


            }

          }

        }
        if (i >= 239 && i < 306) {

          if (i == 239) {
            doc.addPage({
              margin: 50
            })

            // ---------current page -------------

            doc
              .roundedRect(50, 15, 530, 30, 8)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()

              .text("Order nr", 120, 22)
              .text("Order date", 240, 22)
              .text("Products", 360, 22)
              .text("Page", 480, 22)


              .font('Times-Bold').text(`${dataObj.invoiceId}`, 120, 32)
              .text(`${dataObj.date}`, 240, 32)
              .text(`${dataObj.headers.totals.totalProducts}`, 360, 32)
              .text(`${dataObj.headers.page}`, 480, 32)

            // ---------current page -------------
            doc.font('Times-Roman').roundedRect(50, doc.page.height - 35, 520, 0, 0)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()
            doc.text('footer footer  footer  footer  footer  footer', 250, doc.page.height - 30, {
              align: "center",
              lineBreak: false,
            });

            doc.font('Times-Bold').text("#", 50, 50)
              .text("Code", 70, 50)
              .text("Description", 130, 50)
              .text("Contents", 355, 50)
              .text("Qty", 405, 50)
              .text("Vat", 435, 50)
              .text("Price", 480, 50)
              .text("Total", 0, 50, { align: "right" })

              .font('Times-Roman').roundedRect(50, 65, 520, 0, 0)
              .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
              .fill('black').stroke()

          }

          const position = 50 + ((i - 238) + 1) * 10;
          generateTableRow(
            doc,
            position,
            i + 1,
            item.code,
            item.description,
            item.contents,
            item.vat,
            item.quantity,
            item.invoicePrice,
            item.total,

          );

          if (i < 285) {
            if (dataObj.products.length == i + 1) {
              doc
                .roundedRect(350, 30 + (dataObj.products.length - 230) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total Order    ${dataObj.totals.noDiscount}`, 50, 35 + (dataObj.products.length - 230) * 10, { align: "right" })

                .roundedRect(350, 50 + (dataObj.products.length - 230) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Discount (10%)  ${dataObj.totals.discount}`, 50, 55 + (dataObj.products.length - 230) * 10, { align: "right" })

                .roundedRect(350, 70 + (dataObj.products.length - 230) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total 9% Vat Category   ${dataObj.totals.vatCategories[0].totalPrice}`, 50, 75 + (dataObj.products.length - 230) * 10, { align: "right" })

                .roundedRect(350, 90 + (dataObj.products.length - 230) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Ex Vat  ${dataObj.totals.exVat}`, 50, 95 + (dataObj.products.length - 230) * 10, { align: "right" })

                .roundedRect(350, 110 + (dataObj.products.length - 230) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`9% Vat   ${dataObj.totals.vatCategories[0].totalVat}`, 50, 115 + (dataObj.products.length - 230) * 10, { align: "right" })

                .roundedRect(350, 130 + (dataObj.products.length - 230) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Vat   ${dataObj.totals.vat}`, 50, 135 + (dataObj.products.length - 230) * 10, { align: "right" })

                .roundedRect(350, 160 + (dataObj.products.length - 230) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`TOTAL  ${dataObj.totals.total}`, 50, 165 + (dataObj.products.length - 230) * 10, { align: "right" })

                .text(`Payment Terms : ${dataObj.settings.paymentTerms}`, 50, 180 + (dataObj.products.length - 230) * 10)

            }
          }
          else {

            if (dataObj.products.length == i + 1) {
              doc.addPage({
                margin: 50
              })
              doc
                .roundedRect(50, 25, 530, 30, 8)
                .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text("Order nr", 120, 30)
                .text("Order date", 240, 30)
                .text("Products", 360, 30)
                .text("Page", 480, 30)

                .font('Times-Bold').text(`${dataObj.invoiceId}`, 120, 40)
                .text(`${dataObj.date}`, 240, 40)
                .text(`${dataObj.headers.totals.totalProducts}`, 360, 40)
                .text(`${dataObj.headers.page}`, 480, 40)
              doc.font('Times-Roman').roundedRect(50, doc.page.height - 35, 520, 0, 0)
                .fillAndStroke('white', `${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
              doc.text('footer footer  footer  footer  footer  footer', 250, doc.page.height - 30, {
                align: "center",
                lineBreak: false,
              });

              doc
                .roundedRect(350, 60 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total Order    ${dataObj.totals.noDiscount}`, 50, 65 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 80 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Discount (10%)  ${dataObj.totals.discount}`, 50, 85 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 100 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`Total 9% Vat Category   ${dataObj.totals.vatCategories[0].totalPrice}`, 50, 105 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 120 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Ex Vat  ${dataObj.totals.exVat}`, 50, 125 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 140 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`9% Vat   ${dataObj.totals.vatCategories[0].totalVat}`, 50, 145 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 160 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.secondaryColor}`)
                .fill('black').stroke()
                .text(`Total Vat   ${dataObj.totals.vat}`, 50, 165 + (26 - 25) * 10, { align: "right" })

                .roundedRect(350, 200 + (26 - 25) * 10, 215, 20, 0)
                .fillAndStroke(`${dataObj.settings.primaryColor}`)
                .fill('black').stroke()
                .text(`TOTAL  ${dataObj.totals.total}`, 50, 205 + (26 - 25) * 10, { align: "right" })

                .text(`Payment Terms : ${dataObj.settings.paymentTerms}`, 50, 230 + (26 - 25) * 10)


            }


          }


        }



      }


    }


    generateHeader(doc);
    generateInvoiceTable(doc, invoice);
    doc.end();
    doc.pipe(res)
  }
  )
}