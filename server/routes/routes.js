let  dataObj = {
  "headers": {
    "title": "Order to",
    "date": "Order date",
    "invoiceId": "Order nr",
    "noVat": "VAT Statement:",
    "note": "Note:",
    "page": "Page",
    "payment_terms": "Payment Terms:",
    "total": "Total",
    "totals": {
      "noDiscount": "Total Order",
      "discount": "Total Discount (10%)",
      "vatCategories": [
        {
          "category": "9",
          "totalPrice": "Total 9% Vat Category",
          "totalVat": "9% Vat"
        }
      ],
      "totalProducts": "Products",
      "exVat": "Total Ex Vat",
      "incVat": "TOTAL",
      "vat": "Total Vat"
    },
    "products": {
      "code": "Code",
      "contents": "Contents",
      "description": "Description",
      "price": "Price",
      "quantity": "Qty",
      "total": "Total Price",
      "vat": "Vat"
    },
    "profile": {
      "debtorId": "Debtor ID"
    },
    "customer": {
      "coc": "CoC",
      "email": "Email",
      "fax": "Fax",
      "mobile": "Mobile",
      "telephone": "Tel",
      "vat": "Vat",
      "website": "Website"
    }
  },
  "profile": {
    "city": "Hengelo",
    "coc": "76119572",
    "country": "Nederland",
    "email": "emrahhanokruiden40@gmail.com",
    "fax": "",
    "image": "https://newflow.orapay.io/api/v1/images/a6b92c249dc5c913354121257f6992f5_13abbbbc909a6cac42eb654607bab1bdb33d4bd60dcacf0600383f38d33da99565c1ca4b9773c7e469f2b13b27dc5732d09bc425a49ad7569018278cf156ce6cb4ca0249bb17874a10908330d03f895c6673a3baf06031731f9b56e73e749161bc43532a2d9c24d698c13021219ada7c",
    "mobile": "+31642114250",
    "name": "Or.a Trade Solutions BV",
    "street": "Agonstraat",
    "streetNumber": "8",
    "telephone": "+31642114250",
    "vat": "NL860514298B01",
    "website": "www.ora-ts.com",
    "zip": "7552 TJ"
  },
  "customer": {
    "coc": "1",
    "country": "Zimbabue",
    "city": "Harare",
    "debtorId": "123",
    "name": "Acme",
    "streetNumber": "123",
    "street": "Robert mugabe ave",
    "vatApplicable": 1,
    "zip": "0123"
  },
  "products": [
    {
      "description": "Amsterdammertje . (200 gr)",
      "code": "AH-357528",
      "invoicePrice": "$2.66",
      "vat": "9%",
      "contents": "1",
      "quantity": 1,
      "total": "$2.66"
    },
    {
      "description": "Amsterdammertje . (500 gr)",
      "code": "AH-357529",
      "invoicePrice": "$5.6",
      "vat": "9%",
      "contents": "1",
      "quantity": 4,
      "total": "$22.4"
    },
    {
      "description": "Bacardi & Cola 4 pack (4 x 0,25 l gr)",
      "code": "AH-178075",
      "invoicePrice": "$7.79",
      "vat": "9%",
      "contents": "1",
      "quantity": 2,
      "total": "$15.58"
    },
    {
      "description": "Chocomel , fles (1000 ml)",
      "code": "AH-188164",
      "invoicePrice": "$1.53",
      "vat": "9%",
      "contents": "1",
      "quantity": 1,
      "total": "$1.53"
    },
    {
      "description": "Danone & Fruit magere yoghurt kers (125 gr)",
      "code": "AH-222039",
      "invoicePrice": "$1.95",
      "vat": "9%",
      "contents": "4",
      "quantity": 3,
      "total": "$5.85"
    },
    {
      "description": "Danone & Fruit volle yoghurt mix (125 gr)",
      "code": "AH-222042",
      "invoicePrice": "$3.49",
      "vat": "9%",
      "contents": "12",
      "quantity": 2,
      "total": "$6.98"
    },
    {
      "description": "Dauvergne Ranvier & Ranvier",
      "code": "AH-448226",
      "invoicePrice": "$83.94",
      "vat": "9%",
      "contents": "1",
      "quantity": 1,
      "total": "$83.94"
    },
    {
      "description": "Elke Melk . (800 ml)",
      "code": "AH-460620",
      "invoicePrice": "$1.39",
      "vat": "9%",
      "contents": "1",
      "quantity": 1,
      "total": "$1.39"
    },
    {
      "description": "Gulden Draak . (330 ml)",
      "code": "AH-201936",
      "invoicePrice": "$1.45",
      "vat": "9%",
      "contents": "1",
      "quantity": 3,
      "total": "$4.35"
    },
    {
      "description": "HG (combi) magnetron reiniger (500 ml)",
      "code": "AH-170821",
      "invoicePrice": "$3.89",
      "vat": "9%",
      "contents": "1",
      "quantity": 1,
      "total": "$3.89"
    },
    {
      "description": "Jack Daniels & Lynchburg lemon (330 ml)",
      "code": "AH-436939",
      "invoicePrice": "$2.39",
      "vat": "9%",
      "contents": "1",
      "quantity": 1,
      "total": "$2.39"
    },
    {
      "description": "Klene 'n Berg zoet gesuikerd (450 gr)",
      "code": "AH-213580",
      "invoicePrice": "$1.98",
      "vat": "9%",
      "contents": "1",
      "quantity": 3,
      "total": "$5.94"
    },
    {
      "description": "Klene 'n Berg zoete drop (450 gr)",
      "code": "AH-213581",
      "invoicePrice": "$1.98",
      "vat": "9%",
      "contents": "1",
      "quantity": 3,
      "total": "$5.94"
    },
    {
      "description": "La Chouffe + glas (4 x 0.33l gr)",
      "code": "AH-403940",
      "invoicePrice": "$11.49",
      "vat": "9%",
      "contents": "1",
      "quantity": 1,
      "total": "$11.49"
    },
    {
      "description": "Malibu & Cola (250 ml)",
      "code": "AH-198900",
      "invoicePrice": "$1.95",
      "vat": "9%",
      "contents": "1",
      "quantity": 1,
      "total": "$1.95"
    },
    {
      "description": "Malibu & Pineapple (250 ml)",
      "code": "AH-211399",
      "invoicePrice": "$1.89",
      "vat": "9%",
      "contents": "1",
      "quantity": 1,
      "total": "$1.89"
    },
    {
      "description": "Maltesers . (192 gr)",
      "code": "AH-238097",
      "invoicePrice": "$2.09",
      "vat": "9%",
      "contents": "1",
      "quantity": 1,
      "total": "$2.09"
    },
    {
      "description": "Nutella & go (39 gr)",
      "code": "AH-370830",
      "invoicePrice": "$3.09",
      "vat": "9%",
      "contents": "2",
      "quantity": 1,
      "total": "$3.09"
    },
    {
      "description": "Nutella & Go (39 gr)",
      "code": "8868",
      "invoicePrice": "$0.49",
      "vat": "9%",
      "contents": "1",
      "quantity": 3,
      "total": "$1.47"
    },
    {
      "description": "Perrier & juice aardbei kiwi (250 ml)",
      "code": "AH-437934",
      "invoicePrice": "$2.75",
      "vat": "9%",
      "contents": "4",
      "quantity": 3,
      "total": "$8.25"
    },
    {
      "description": "Perrier & juice perzik kers (250 ml)",
      "code": "AH-437932",
      "invoicePrice": "$2.75",
      "vat": "9%",
      "contents": "4",
      "quantity": 1,
      "total": "$2.75"
    },
    {
      "description": "Pure blonde . (250 ml)",
      "code": "AH-435204",
      "invoicePrice": "$3.9",
      "vat": "9%",
      "contents": "6",
      "quantity": 1,
      "total": "$3.9"
    },
    {
      "description": "Sao Miguel do Sul . (750 ml)",
      "code": "AH-382911",
      "invoicePrice": "$5.99",
      "vat": "9%",
      "contents": "1",
      "quantity": 1,
      "total": "$5.99"
    },
    {
      "description": "Tripel Karmeliet . (330 ml)",
      "code": "AH-438908",
      "invoicePrice": "$6.89",
      "vat": "9%",
      "contents": "4",
      "quantity": 1,
      "total": "$6.89"
    }
  ],
  "date": "2020-03-18",
  "totals": {
    "vatCategories": [
      {
        "category": "9",
        "totalPrice": "$191.34",
        "totalVat": "$17.22"
      }
    ],
    "discount": "$21.26",
    "exVat": "$191.34",
    "incVat": "$208.56",
    "noDiscount": "$212.60",
    "totalProducts": 41,
    "vat": "$17.22",
    "total": "$208.56"
  },
  "settings": {
    "paymentTerms": "Within 14 days after invoice date.",
    "note": "Some note to customers",
    "footer": "This should show on each page at the footer."
  },
  "invoiceId": "ORD-123-000037"
}
 
var dotenv = require('dotenv');
var path = require("path")
const PDFDocument = require('pdfkit');
const fs = require('fs');
const invoice = {
    shipping: {
      name: "John Doe",
      address: "1234 Main Street",
      city: "San Francisco",
      state: "CA",
      country: "US",
      postal_code: 94111
    },
    items: [
      {
        item: "TC 100",
        description: "Toner Cartridge",
        quantity: 2,
        amount: 6000
      },
      {
        item: "USB_EXT",
        description: "USB Cable Extender",
        quantity: 1,
        amount: 2000
      }
    ],
    subtotal: 8000,
    paid: 0,
    invoice_nr: 1234
  };
 
dotenv.config();

console.log("data:",dataObj)



module.exports = function (server) {
  server.get('/generatePdf', (req, res) => {
    let doc = new PDFDocument({ margin: 50 });
    function generateHeader(doc) {
        doc
        .image(__dirname+'/img.jpg', 40, 30, {fit: [180, 230]})
        .roundedRect(330, 30, 250, 220, 10)
        .fillAndStroke( '#8DDBF6','#8DDBF6')
        .fill('black').stroke()
       
        .font('Times-Bold').text(`${dataObj.headers.title}`, 40, 110 )
        .font('Times-Bold').text("Hassan", 40, 140 )
        .font('Times-Roman').text("1", 40, 160 )
        .text("2", 40, 170 )
        .text("3", 40, 180 )
        .text("4", 40, 210 )
        .text(`Debtor: ${dataObj.headers.profile.debtorId}`, 40, 220 )
        .text(`Vat: ${dataObj.headers.products.vat}`, 40, 230 )   
        
        .text("Tell", 340, 110)
        .text("Mobile ", 340, 130)
        .text("cov", 340, 150)
        .text("vot", 340, 170)
        .text("email",340, 190)
        .text("website", 340, 210)

        .font('Times-Bold').text("This is a PDFKIT", 0, 40 ,  { align: "right" })
        .font('Times-Roman').text("asdjflss", 0, 70 ,  { align: "right" })
        .text("asdjflss", 0, 80 ,  { align: "right" })
        .text("asdjflss", 0, 90 ,  { align: "right" })
        
        .text(`${dataObj.headers.customer.telephone}`, 0, 110 ,  { align: "right" })
        .text(`${dataObj.headers.customer.mobile}`, 0, 130 ,  { align: "right" })
        .text(`${dataObj.headers.customer.coc}`, 0, 150 ,  { align: "right" })
        .text(`${dataObj.headers.customer.vat}`, 0,170 ,  { align: "right" })
        .text(`${dataObj.headers.customer.email}`, 0,190 ,  { align: "right" })
        .text(`${dataObj.headers.customer.website}`, 0,210 ,  { align: "right" })

        
        .roundedRect(50, 270, 530, 40, 8)
        .fillAndStroke( 'white','#8DDBF6')
        .fill('black').stroke()

        .font('Times-Bold').text("Order nr", 120, 280)
        .text("Order date", 240, 280)
        .text("Products", 360, 280)
        .text("Page", 480, 280)

        .font('Times-Roman').text(`${dataObj.headers.invoiceId}`, 120, 290)
        .text(`${dataObj.headers.date}`, 240, 290)
        .text(`${dataObj.headers.totals.totalProducts}`, 360, 290)
        .text(`${dataObj.headers.page}`, 480, 290)


        .roundedRect(50, 340, 530, 0, 0)
        .fillAndStroke( 'white','#8DDBF6')
        .fill('black').stroke()

        .text("#", 50, 320)
        .text("Code", 70, 320)
        .text("Description", 130, 320)
        .text("Contents", 350, 320)
        .text("Qty", 405, 320)
        .text("Vat", 435, 320)
        .text("Price", 480, 320)
        .text("Total", 0, 320 ,{ align: "right" })



      }
      
      function generateFooter(doc) {
        doc
          .fontSize(10)
          .text(
            "Payment is due within 15 days. Thank you for your business.",
            50,
            780,
            { align: "center", width: 500 }
          );
      }
      // function generateCustomerInformation(doc, invoice) {
      //   const shipping = invoice.shipping;
      
      //   doc
      //     .text(`Invoice Number: ${invoice.invoice_nr}`, 50, 200)
      //     .text(`Invoice Date: ${new Date()}`, 50, 215)
      //     .text(`Balance Due: ${invoice.subtotal - invoice.paid}`, 50, 130)
      
      //     .text(shipping.name, 300, 200)
      //     .text(shipping.address, 300, 215)
      //     .text(`${shipping.city}, ${shipping.state}, ${shipping.country}`, 500, 130)
      //     .moveDown();
      // }
       
      function generateTableRow(doc, y, c1, c2, c3, c4, c5,c6,c7 ,c8) {
        doc
          .fontSize(10)
          .text(c1, 50, y)
          .text(c2, 70, y)
          .text(c3, 130, y)
          .text(c4, 380, y)
          .text(c5, 410, y )
          .text(c6, 440, y)
          .text(c7, 480, y)
          .text(c8, 0, y, { align: "right" });

      }

function generateInvoiceTable(doc, invoice) {
    let i,
      invoiceTableTop = 340;
  
    for (i = 0; i < dataObj.products.length; i++) {
      const item = dataObj.products[i];
      const position = invoiceTableTop + (i + 1) * 10;
      generateTableRow(
        doc,
        position,
        i,
        item.code,
        item.description,
        item.contents,
        item.quantity,
        item.vat,
        item.invoicePrice,
        item.total,

      );
    }
  }
        generateHeader(doc);
        // generateCustomerInformation(doc, invoice);
        generateInvoiceTable(doc, invoice);
        generateFooter(doc);
      
        doc.end();
        doc.pipe(fs.createWriteStream('output.pdf'));
      
     res.send('creeated')
    }
  )}